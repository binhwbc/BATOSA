
<!--
/*******************************************************************************
*                                 Opencart SEO Pack                            *
*                             Copyright : Ovidiu Fechete                       *
*                              email: ovife21@gmail.com                        *
*                Below source-code or any part of the source-code              *
*                          cannot be resold or distributed.                    *
*******************************************************************************/
-->

<modification>

	<id>Multi Language SEO Keywords</id>
	<version>1.0.0</version>
	<vqmver>2.1.5</vqmver>
	<author>ovife21</author>
	
	<file name="admin/view/template/setting/setting.tpl">
		<operation>
			<search position="replace"><![CDATA[<input type="text" name="config_meta_title" value="<?php echo $config_meta_title; ?>" placeholder="<?php echo $entry_meta_title; ?>" id="input-meta-title" class="form-control" />]]></search>
			<add><![CDATA[
			<?php foreach ($languages as $language) { ?>
			<input type="text" name="config_meta_title[<?php echo $language['language_id']; ?>]" value="<?php  if (isset($config_meta_title[$language['language_id']])) { echo $config_meta_title[$language['language_id']]; } ?>" placeholder="<?php echo $entry_meta_title; ?>" id="input-meta-title" class="form-control" />
			<?php if (VERSION >= '2.2.0.0') { ?>
		 <img src="language/<?php echo $language['code']; ?>/<?php echo $language['code']; ?>.png" title="<?php echo $language['name']; ?>" />
		 <?php } else { ?>
		 <img src="view/image/flags/<?php echo $language['image']; ?>" title="<?php echo $language['name']; ?>" />
		 <?php }  ?>
		 <br>
			<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[<textarea name="config_meta_description" rows="5" placeholder="<?php echo $entry_meta_description; ?>" id="input-meta-description" class="form-control"><?php echo $config_meta_description; ?></textarea>]]></search>
			<add><![CDATA[
			<?php foreach ($languages as $language) { ?>
			<textarea name="config_meta_description[<?php echo $language['language_id']; ?>]" rows="5" placeholder="<?php echo $entry_meta_description; ?>" id="input-meta-description" class="form-control"><?php if (isset($config_meta_description[$language['language_id']])) { echo $config_meta_description[$language['language_id']]; } ?></textarea>
			<?php if (VERSION >= '2.2.0.0') { ?>
		 <img src="language/<?php echo $language['code']; ?>/<?php echo $language['code']; ?>.png" title="<?php echo $language['name']; ?>" />
		 <?php } else { ?>
		 <img src="view/image/flags/<?php echo $language['image']; ?>" title="<?php echo $language['name']; ?>" />
		 <?php }  ?>
		 <br>
			<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[<textarea name="config_meta_keyword" rows="5" placeholder="<?php echo $entry_meta_keyword; ?>" id="input-meta-keyword" class="form-control"><?php echo $config_meta_keyword; ?></textarea>]]></search>
			<add><![CDATA[
			<?php foreach ($languages as $language) { ?>
			<textarea name="config_meta_keyword[<?php echo $language['language_id']; ?>]" rows="5" placeholder="<?php echo $entry_meta_keyword; ?>" id="input-meta-keyword" class="form-control"><?php if (isset($config_meta_keyword[$language['language_id']])) { echo $config_meta_keyword[$language['language_id']]; } ?></textarea>
			<?php if (VERSION >= '2.2.0.0') { ?>
		 <img src="language/<?php echo $language['code']; ?>/<?php echo $language['code']; ?>.png" title="<?php echo $language['name']; ?>" />
		 <?php } else { ?>
		 <img src="view/image/flags/<?php echo $language['image']; ?>" title="<?php echo $language['name']; ?>" />
		 <?php }  ?>
		 <br>
			<?php } ?>
			]]></add>
		</operation>			
	</file>
	
	<file name="admin/controller/setting/setting.php">
		<operation>
			<search position="before"><![CDATA[if (isset($this->request->post['config_meta_title'])) {]]></search>
			<add><![CDATA[$data['config_meta_title'] =array();
			]]></add>
		</operation>
		<operation>
			<search position="before"><![CDATA[if (isset($this->request->post['config_meta_description'])) {]]></search>
			<add><![CDATA[$data['config_meta_description'] =array();
			]]></add>
		</operation>
		<operation>
			<search position="before"><![CDATA[if (isset($this->request->post['config_meta_keyword'])) {]]></search>
			<add><![CDATA[$data['config_meta_keyword'] =array();
			]]></add>
		</operation>			
	</file>
        <file name="admin/view/template/setting/store_form.tpl">
		<operation>
			<search position="replace"><![CDATA[<input type="text" name="config_meta_title" value="<?php echo $config_meta_title; ?>" placeholder="<?php echo $entry_meta_title; ?>" id="input-meta-title" class="form-control" />]]></search>
			<add><![CDATA[
			<?php foreach ($languages as $language) { ?>
			<input type="text" name="config_meta_title[<?php echo $language['language_id']; ?>]" value="<?php  if (isset($config_meta_title[$language['language_id']])) { echo $config_meta_title[$language['language_id']]; } ?>" placeholder="<?php echo $entry_meta_title; ?>" id="input-meta-title" class="form-control" />
			<?php if (VERSION >= '2.2.0.0') { ?>
		 <img src="language/<?php echo $language['code']; ?>/<?php echo $language['code']; ?>.png" title="<?php echo $language['name']; ?>" />
		 <?php } else { ?>
		 <img src="view/image/flags/<?php echo $language['image']; ?>" title="<?php echo $language['name']; ?>" />
		 <?php }  ?>
		 <br>
			<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[<textarea name="config_meta_description" rows="5" placeholder="<?php echo $entry_meta_description; ?>" id="input-meta-description" class="form-control"><?php echo $config_meta_description; ?></textarea>]]></search>
			<add><![CDATA[
			<?php foreach ($languages as $language) { ?>
			<textarea name="config_meta_description[<?php echo $language['language_id']; ?>]" rows="5" placeholder="<?php echo $entry_meta_description; ?>" id="input-meta-description" class="form-control"><?php if (isset($config_meta_description[$language['language_id']])) { echo $config_meta_description[$language['language_id']]; } ?></textarea>
			<?php if (VERSION >= '2.2.0.0') { ?>
		 <img src="language/<?php echo $language['code']; ?>/<?php echo $language['code']; ?>.png" title="<?php echo $language['name']; ?>" />
		 <?php } else { ?>
		 <img src="view/image/flags/<?php echo $language['image']; ?>" title="<?php echo $language['name']; ?>" />
		 <?php }  ?>
		 <br>
			<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[<textarea name="config_meta_keyword" rows="5" placeholder="<?php echo $entry_meta_keyword; ?>" id="input-meta-keyword" class="form-control"><?php echo $config_meta_keyword; ?></textarea>]]></search>
			<add><![CDATA[
			<?php foreach ($languages as $language) { ?>
			<textarea name="config_meta_keyword[<?php echo $language['language_id']; ?>]" rows="5" placeholder="<?php echo $entry_meta_keyword; ?>" id="input-meta-keyword" class="form-control"><?php if (isset($config_meta_keyword[$language['language_id']])) { echo $config_meta_keyword[$language['language_id']]; } ?></textarea>
			<?php if (VERSION >= '2.2.0.0') { ?>
		 <img src="language/<?php echo $language['code']; ?>/<?php echo $language['code']; ?>.png" title="<?php echo $language['name']; ?>" />
		 <?php } else { ?>
		 <img src="view/image/flags/<?php echo $language['image']; ?>" title="<?php echo $language['name']; ?>" />
		 <?php }  ?>
		 <br>
			<?php } ?>
			]]></add>
		</operation>			
	</file>
	
	<file name="admin/controller/setting/store.php">
		<operation>
			<search position="before"><![CDATA[if (isset($this->request->post['config_meta_title'])) {]]></search>
			<add><![CDATA[$data['config_meta_title'] =array();
			]]></add>
		</operation>
		<operation>
			<search position="before"><![CDATA[if (isset($this->request->post['config_meta_description'])) {]]></search>
			<add><![CDATA[$data['config_meta_description'] =array();
			]]></add>
		</operation>
		<operation>
			<search position="before"><![CDATA[if (isset($this->request->post['config_meta_keyword'])) {]]></search>
			<add><![CDATA[$data['config_meta_keyword'] =array();
			]]></add>
		</operation>			
	</file>
	
	<file name="catalog/controller/common/home.php">
		<operation>
			<search position="replace"><![CDATA[$this->config->get('config_meta_title')]]></search>
			<add><![CDATA[$titles[$this->config->get('config_language_id')]]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[$this->config->get('config_meta_description')]]></search>
			<add><![CDATA[$meta_descriptions[$this->config->get('config_language_id')]]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[$this->config->get('config_meta_keyword')]]></search>
			<add><![CDATA[$meta_keywords[$this->config->get('config_language_id')]]]></add>
		</operation>	
		<operation>
			<search position="before"><![CDATA[$this->document->setTitle]]></search>
			<add><![CDATA[			
			$this->session->data['proute'] = 'common/home';
			$titles = $this->config->get('config_meta_title');
			$meta_descriptions = $this->config->get('config_meta_description');
			$meta_keywords = $this->config->get('config_meta_keyword');
			]]></add>
		</operation>				
	</file>
	
	<file name="admin/view/template/catalog/product_form.tpl">
		<operation>
			<search position="replace"><![CDATA[<input type="text" name="keyword" value="<?php echo $keyword; ?>" placeholder="<?php echo $entry_keyword; ?>" id="input-keyword" class="form-control" />]]></search>
			<add><![CDATA[
			<?php foreach ($languages as $language) { ?>
			<input type="text" name="keyword[<?php echo $language['language_id']; ?>]" value="<?php  if (isset($keyword[$language['language_id']])) { echo $keyword[$language['language_id']]; } ?>" />
			<?php if (VERSION >= '2.2.0.0') { ?>
		 <img src="language/<?php echo $language['code']; ?>/<?php echo $language['code']; ?>.png" title="<?php echo $language['name']; ?>" />
		 <?php } else { ?>
		 <img src="view/image/flags/<?php echo $language['image']; ?>" title="<?php echo $language['name']; ?>" />
		 <?php }  ?>
		 <br>
			<?php } ?>
			]]></add>
		</operation>			
	</file>
	
	<file name="admin/controller/catalog/product.php">
		<operation>
			<search position="replace"><![CDATA[$data['keyword'] = $product_info['keyword'];]]></search>
			<add><![CDATA[$data['keyword'] = $this->model_catalog_product->getKeyWords($this->request->get['product_id']);]]></add>
		</operation>	
		<operation>
			<search position="replace"><![CDATA[$data['keyword'] = '';]]></search>
			<add><![CDATA[$data['keyword'] = array();]]></add>
		</operation>
		<operation error="skip">
			<search position="replace"><![CDATA[utf8_strlen($this->request->post['keyword'])]]></search>
			<add><![CDATA[utf8_strlen(current($this->request->post['keyword']))]]></add>
		</operation>
		<operation error="skip">
			<search position="replace"><![CDATA[getUrlAlias($this->request->post['keyword'])]]></search>
			<add><![CDATA[getUrlAlias(current($this->request->post['keyword']))]]></add>
		</operation>
		<operation>
			<search position="after"><![CDATA[$this->document->setTitle($this->language->get('heading_title'));]]></search>
			<add><![CDATA[
			$query = $this->db->query("SHOW COLUMNS FROM " . DB_PREFIX . "url_alias WHERE field = 'language_id'");

			$exists = 0;
			foreach ($query->rows as $index) {$exists++;}

			if (!$exists) {$this->db->query("ALTER TABLE " . DB_PREFIX . "url_alias ADD COLUMN `language_id` int(11) NOT NULL DEFAULT '". $this->config->get('config_language_id') ."';");}
			
			]]></add>
		</operation>			
	</file>

	<file name="admin/model/catalog/product.php">
		<operation>
			<search position="replace"><![CDATA[$this->db->query("INSERT INTO " . DB_PREFIX . "url_alias SET query = 'product_id=" . (int)$product_id . "', keyword = '" . $this->db->escape($data['keyword']) . "'");]]></search>
			<add><![CDATA[
			foreach ($data['keyword'] as $language_id => $keyword) {
				if ($keyword) {$this->db->query("INSERT INTO " . DB_PREFIX . "url_alias SET query = 'product_id=" . (int)$product_id . "', keyword = '" . $this->db->escape($keyword) . "', language_id = " . $language_id);}
			}
			]]></add>
		</operation>
		<operation error="skip">
			<search position="replace"><![CDATA[$this->db->query("INSERT INTO " . DB_PREFIX . "url_alias SET query = 'product_id=" . (int) $product_id . "', keyword = '" . $this->db->escape($data['keyword']) . "'");]]></search>
			<add><![CDATA[
			foreach ($data['keyword'] as $language_id => $keyword) {
				if ($keyword) {$this->db->query("INSERT INTO " . DB_PREFIX . "url_alias SET query = 'product_id=" . (int)$product_id . "', keyword = '" . $this->db->escape($keyword) . "', language_id = " . $language_id);}
			}
			]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[$data['keyword'] = '';]]></search>
			<add><![CDATA[$data['keyword'] = array();]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[, (SELECT keyword FROM " . DB_PREFIX . "url_alias WHERE query = 'product_id=" . (int)$product_id . "') AS keyword]]></search>
			<add><![CDATA[]]></add>
		</operation>	
		<operation>
			<search position="before"><![CDATA[public function getProduct($product_id) {]]></search>
			<add><![CDATA[
			public function getKeyWords($product_id) {
				$keywords = array();
				
				$query = $this->db->query("SELECT * FROM " . DB_PREFIX . "url_alias WHERE query = 'product_id=" . (int)$product_id . "'");
						
				foreach ($query->rows as $result) {
					$keywords[$result['language_id']] = $result['keyword'];					
				}
				
				return $keywords;
			}
			]]></add>
		</operation>			
	</file>	
	
	
	
	<file name="admin/controller/catalog/category.php">
		<operation>
			<search position="replace"><![CDATA[$data['keyword'] = $category_info['keyword'];]]></search>
			<add><![CDATA[$data['keyword'] = $this->model_catalog_category->getKeyWords($this->request->get['category_id']);]]></add>
		</operation>	
		<operation>
			<search position="replace"><![CDATA[$data['keyword'] = '';]]></search>
			<add><![CDATA[$data['keyword'] = array();]]></add>
		</operation>
		<operation error="skip">
			<search position="replace"><![CDATA[utf8_strlen($this->request->post['keyword'])]]></search>
			<add><![CDATA[utf8_strlen(current($this->request->post['keyword']))]]></add>
		</operation>
		<operation error="skip">
			<search position="replace"><![CDATA[getUrlAlias($this->request->post['keyword'])]]></search>
			<add><![CDATA[getUrlAlias(current($this->request->post['keyword']))]]></add>
		</operation>	
	</file>
	
	<file name="admin/model/catalog/category.php">
		<operation>
			<search position="replace"><![CDATA[$this->db->query("INSERT INTO " . DB_PREFIX . "url_alias SET query = 'category_id=" . (int)$category_id . "', keyword = '" . $this->db->escape($data['keyword']) . "'");]]></search>
			<add><![CDATA[
			foreach ($data['keyword'] as $language_id => $keyword) {
				if ($keyword) {$this->db->query("INSERT INTO " . DB_PREFIX . "url_alias SET query = 'category_id=" . (int)$category_id . "', keyword = '" . $this->db->escape($keyword) . "', language_id = " . $language_id);}
			}
			]]></add>
		</operation>
		<operation error="skip">
			<search position="replace"><![CDATA[, (SELECT keyword FROM " . DB_PREFIX . "url_alias WHERE query = 'category_id=" . (int)$category_id . "') AS keyword]]></search>
			<add><![CDATA[]]></add>
		</operation>	
		<operation error="skip">
			<search position="replace"><![CDATA[, (SELECT DISTINCT keyword FROM " . DB_PREFIX . "url_alias WHERE query = 'category_id=" . (int)$category_id . "') AS keyword]]></search>
			<add><![CDATA[]]></add>
		</operation>	
		<operation>
			<search position="before"><![CDATA[public function getCategory($category_id) {]]></search>
			<add><![CDATA[
			public function getKeyWords($category_id) {
				$keywords = array();
				
				$query = $this->db->query("SELECT * FROM " . DB_PREFIX . "url_alias WHERE query = 'category_id=" . (int)$category_id . "'");
						
				foreach ($query->rows as $result) {
					$keywords[$result['language_id']] = $result['keyword'];					
				}
				
				return $keywords;
			}
			]]></add>
		</operation>			
	</file>	
	<file name="admin/view/template/catalog/category_form.tpl">
		<operation>
			<search position="replace"><![CDATA[<input type="text" name="keyword" value="<?php echo $keyword; ?>" placeholder="<?php echo $entry_keyword; ?>" id="input-keyword" class="form-control" />]]></search>
			<add><![CDATA[
			<?php foreach ($languages as $language) { ?>
			<input type="text" name="keyword[<?php echo $language['language_id']; ?>]" value="<?php if (isset($keyword[$language['language_id']])) { echo $keyword[$language['language_id']]; } ?>" placeholder="<?php echo $entry_keyword; ?>" id="input-keyword" class="form-control" />
			<?php if (VERSION >= '2.2.0.0') { ?>
		 <img src="language/<?php echo $language['code']; ?>/<?php echo $language['code']; ?>.png" title="<?php echo $language['name']; ?>" />
		 <?php } else { ?>
		 <img src="view/image/flags/<?php echo $language['image']; ?>" title="<?php echo $language['name']; ?>" />
		 <?php }  ?>
		 <br>
			<?php } ?>
			]]></add>
		</operation>			
	</file>
	<file name="admin/view/template/catalog/manufacturer_form.tpl">
		<operation>
			<search position="replace"><![CDATA[<input type="text" name="keyword" value="<?php echo $keyword; ?>" placeholder="<?php echo $entry_keyword; ?>" id="input-keyword" class="form-control" />]]></search>
			<add><![CDATA[
			<?php foreach ($languages as $language) { ?>
			<input type="text" name="keyword[<?php echo $language['language_id']; ?>]" value="<?php if (isset($keyword[$language['language_id']])) { echo $keyword[$language['language_id']]; } ?>" placeholder="<?php echo $entry_keyword; ?>" id="input-keyword" class="form-control" />
			<?php if (VERSION >= '2.2.0.0') { ?>
		 <img src="language/<?php echo $language['code']; ?>/<?php echo $language['code']; ?>.png" title="<?php echo $language['name']; ?>" />
		 <?php } else { ?>
		 <img src="view/image/flags/<?php echo $language['image']; ?>" title="<?php echo $language['name']; ?>" />
		 <?php }  ?>
		 
			<?php } ?>
			]]></add>
		</operation>			
	</file>
	
	<file name="admin/controller/catalog/manufacturer.php">
		<operation>
			<search position="replace"><![CDATA[$data['keyword'] = $manufacturer_info['keyword'];]]></search>
			<add><![CDATA[$data['keyword'] = $this->model_catalog_manufacturer->getKeyWords($this->request->get['manufacturer_id']);]]></add>
		</operation>	
		<operation>
			<search position="replace"><![CDATA[$data['keyword'] = '';]]></search>
			<add><![CDATA[$data['keyword'] = array();]]></add>
		</operation>
		<operation>
			<search position="before"><![CDATA[$data['token'] = $this->session->data['token'];]]></search>
			<add><![CDATA[
			$this->load->model('localisation/language');
		
			$data['languages'] = $this->model_localisation_language->getLanguages();
			]]></add>
		</operation>
		<operation error="skip">
			<search position="replace"><![CDATA[utf8_strlen($this->request->post['keyword'])]]></search>
			<add><![CDATA[utf8_strlen(current($this->request->post['keyword']))]]></add>
		</operation>
		<operation error="skip">
			<search position="replace"><![CDATA[getUrlAlias($this->request->post['keyword'])]]></search>
			<add><![CDATA[getUrlAlias(current($this->request->post['keyword']))]]></add>
		</operation>	
	</file>
	
	<file name="admin/model/catalog/manufacturer.php">
		<operation>
			<search position="replace"><![CDATA[$this->db->query("INSERT INTO " . DB_PREFIX . "url_alias SET query = 'manufacturer_id=" . (int)$manufacturer_id . "', keyword = '" . $this->db->escape($data['keyword']) . "'");]]></search>
			<add><![CDATA[
			foreach ($data['keyword'] as $language_id => $keyword) {
				if ($keyword) {$this->db->query("INSERT INTO " . DB_PREFIX . "url_alias SET query = 'manufacturer_id=" . (int)$manufacturer_id . "', keyword = '" . $this->db->escape($keyword) . "', language_id = " . $language_id);}
			}
			]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[, (SELECT keyword FROM " . DB_PREFIX . "url_alias WHERE query = 'manufacturer_id=" . (int)$manufacturer_id . "') AS keyword]]></search>
			<add><![CDATA[]]></add>
		</operation>	
		<operation>
			<search position="before"><![CDATA[public function getManufacturer($manufacturer_id) {]]></search>
			<add><![CDATA[
			public function getKeyWords($manufacturer_id) {
				$keywords = array();
				
				$query = $this->db->query("SELECT * FROM " . DB_PREFIX . "url_alias WHERE query = 'manufacturer_id=" . (int)$manufacturer_id . "'");
						
				foreach ($query->rows as $result) {
					$keywords[$result['language_id']] = $result['keyword'];					
				}
				
				return $keywords;
			}
			]]></add>
		</operation>			
	</file>	
	
	<file name="admin/view/template/catalog/information_form.tpl">
		<operation>
			<search position="replace"><![CDATA[<input type="text" name="keyword" value="<?php echo $keyword; ?>" placeholder="<?php echo $entry_keyword; ?>" id="input-keyword" class="form-control" />]]></search>
			<add><![CDATA[
			<?php foreach ($languages as $language) { ?>
			<input type="text" name="keyword[<?php echo $language['language_id']; ?>]" value="<?php if (isset($keyword[$language['language_id']])) { echo $keyword[$language['language_id']]; } ?>" placeholder="<?php echo $entry_keyword; ?>" id="input-keyword" class="form-control" />
			<?php if (VERSION >= '2.2.0.0') { ?>
		 <img src="language/<?php echo $language['code']; ?>/<?php echo $language['code']; ?>.png" title="<?php echo $language['name']; ?>" />
		 <?php } else { ?>
		 <img src="view/image/flags/<?php echo $language['image']; ?>" title="<?php echo $language['name']; ?>" />
		 <?php }  ?>
		 <br>
			<?php } ?>
			]]></add>
		</operation>			
	</file>
	
	<file name="admin/controller/catalog/information.php">
		<operation>
			<search position="replace"><![CDATA[$data['keyword'] = $information_info['keyword'];]]></search>
			<add><![CDATA[$data['keyword'] = $this->model_catalog_information->getKeyWords($this->request->get['information_id']);]]></add>
		</operation>	
		<operation>
			<search position="replace"><![CDATA[$data['keyword'] = '';]]></search>
			<add><![CDATA[$data['keyword'] = array();]]></add>
		</operation>
		<operation error="skip">
			<search position="replace"><![CDATA[utf8_strlen($this->request->post['keyword'])]]></search>
			<add><![CDATA[utf8_strlen(current($this->request->post['keyword']))]]></add>
		</operation>
		<operation error="skip">
			<search position="replace"><![CDATA[getUrlAlias($this->request->post['keyword'])]]></search>
			<add><![CDATA[getUrlAlias(current($this->request->post['keyword']))]]></add>
		</operation>		
	</file>
	
	<file name="admin/model/catalog/information.php">
		<operation>
			<search position="replace"><![CDATA[$this->db->query("INSERT INTO " . DB_PREFIX . "url_alias SET query = 'information_id=" . (int)$information_id . "', keyword = '" . $this->db->escape($data['keyword']) . "'");]]></search>
			<add><![CDATA[
			foreach ($data['keyword'] as $language_id => $keyword) {
				if ($keyword) {$this->db->query("INSERT INTO " . DB_PREFIX . "url_alias SET query = 'information_id=" . (int)$information_id . "', keyword = '" . $this->db->escape($keyword) . "', language_id = " . $language_id);}
			}
			]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[, (SELECT keyword FROM " . DB_PREFIX . "url_alias WHERE query = 'information_id=" . (int)$information_id . "') AS keyword]]></search>
			<add><![CDATA[]]></add>
		</operation>	
		<operation>
			<search position="before"><![CDATA[public function getInformation($information_id) {]]></search>
			<add><![CDATA[
			public function getKeyWords($information_id) {
				$keywords = array();
				
				$query = $this->db->query("SELECT * FROM " . DB_PREFIX . "url_alias WHERE query = 'information_id=" . (int)$information_id . "'");
						
				foreach ($query->rows as $result) {
					$keywords[$result['language_id']] = $result['keyword'];					
				}
				
				return $keywords;
			}
			]]></add>
		</operation>			
	</file>	
	
	<file name="catalog/controller/common/seo_url.php,catalog/controller/startup/seo_url.php" error="skip">
		<operation error="skip">
			<search position="replace"><![CDATA[$query = $this->db->query("SELECT * FROM " . DB_PREFIX . "url_alias WHERE keyword]]></search>
			<add><![CDATA[$query = $this->db->query("SELECT u.query, u.keyword, u.language_id as lid, l.code".((VERSION >= '2.2.0.0')? "" : ", l.directory")." FROM " . DB_PREFIX . "url_alias u left join " . DB_PREFIX . "language l on u.language_id = l.language_id WHERE u.keyword]]></add>
		</operation>
		<operation error="skip">
			<search position="replace"><![CDATA[$url = '';]]></search>
			<add><![CDATA[
				$squery = $this->db->query("SELECT `value` FROM `" . DB_PREFIX . "setting` WHERE `key` = 'config_language'");
				$mlseo = $this->config->get('mlseo');				
				if (isset($this->session->data['language']) && (isset($mlseo['subfolder']))  && ($this->session->data['language'] <> $squery->row['value']) && (strpos($link, 'blog') == false)) {$url = '/'.$this->session->data['language'];}

				else {$url = '';}]]></add>
		</operation>
		<operation error="skip">
			<search position="before"><![CDATA[if (isset($this->request->get['_route_'])) {]]></search>
			<add><![CDATA[
			
			if (isset($this->request->get['route']) && (strpos($this->request->get['route'], 'language') === false) && (strpos($this->request->get['route'], 'checkout/login') === false)  && (strpos($this->request->get['route'], 'checkout/register') === false) 
			&& (strpos($this->request->get['route'], 'review') === false) && (strpos($this->request->get['route'], 'module') === false) && (strpos($this->request->get['route'], 'shopme') === false) && (strpos($this->request->get['route'], 'journal2') === false) && (strpos($this->request->get['route'], 'nitro') === false) && (strpos($this->request->get['route'], 'country') === false) && (strpos($this->request->get['route'], 'customfield') === false)) {
			$this->session->data['proute'] = $this->request->get['route'];			
			}
			
			if (isset($this->request->get['_route_'])) {
			$lquery = $this->db->query("SELECT * FROM " . DB_PREFIX . "language;");			
			foreach ($lquery->rows as $language) {
				if ((strpos($this->request->get['_route_'],$language['code'].'/')) === 0) {
					$this->session->data['language'] = $language['code']; 
					$this->language = new Language((VERSION >= '2.2.0.0')? $language['code'] : $language['directory']);
					$this->language->load((VERSION >= '2.2.0.0')? $language['code'] : $language['directory']); 
					$this->registry->set('language', $this->language); 
					$this->config->set('config_language_id', $language['language_id']); 					
					$this->request->get['_route_'] = substr( $this->request->get['_route_'], strlen($language['code'].'/'));
					
			        }
			}
			if ($this->request->get['_route_'] == '') 
				{
				unset($this->request->get['_route_']);
				$this->session->data['proute'] = 'common/home';
				}
			
			}
			]]></add>
		</operation>
		<operation error="skip">
			<search position="after"><![CDATA[if ($url[0] == 'category_id') {]]></search>
			<add><![CDATA[
			if (($this->session->data['language'] <> $query->row['code']) || (!isset($this->session->data['language'])))
				{
				$this->session->data['language'] = $query->row['code']; 
				$this->language = new Language((VERSION >= '2.2.0.0')? $language['code'] : $language['directory']);
				$this->language->load((VERSION >= '2.2.0.0')? $language['code'] : $language['directory']); 
				$this->registry->set('language', $this->language); 
				$this->config->set('config_language_id', $query->row['lid']);					
				}
			]]></add>
		</operation>
		<operation error="skip">
			<search position="after"><![CDATA[if ($url[0] == 'product_id') {]]></search>
			<add><![CDATA[
			if (($this->session->data['language'] <> $query->row['code']) || (!isset($this->session->data['language'])))
				{
				$this->session->data['language'] = $query->row['code']; 
				$this->language = new Language((VERSION >= '2.2.0.0')? $language['code'] : $language['directory']);
				$this->language->load((VERSION >= '2.2.0.0')? $language['code'] : $language['directory']); 
				$this->registry->set('language', $this->language); 
				$this->config->set('config_language_id', $query->row['lid']);  				
				}
			]]></add>
		</operation>
		<operation error="skip">
			<search position="after"><![CDATA[if ($url[0] == 'manufacturer_id') {]]></search>
			<add><![CDATA[
			if (($this->session->data['language'] <> $query->row['code']) || (!isset($this->session->data['language'])))
				{
				$this->session->data['language'] = $query->row['code']; 
				$this->language = new Language((VERSION >= '2.2.0.0')? $language['code'] : $language['directory']);
				$this->language->load((VERSION >= '2.2.0.0')? $language['code'] : $language['directory']); 
				$this->registry->set('language', $this->language); 
				$this->config->set('config_language_id', $query->row['lid']);  
				}
			]]></add>
		</operation>
		<operation error="skip">
			<search position="after"><![CDATA[if ($url[0] == 'information_id') {]]></search>
			<add><![CDATA[
			if (($this->session->data['language'] <> $query->row['code']) || (!isset($this->session->data['language'])))
				{
				$this->session->data['language'] = $query->row['code']; 
				$this->language = new Language((VERSION >= '2.2.0.0')? $language['code'] : $language['directory']);
				$this->language->load((VERSION >= '2.2.0.0')? $language['code'] : $language['directory']); 
				$this->registry->set('language', $this->language); 
				$this->config->set('config_language_id', $query->row['lid']); 
				}
			]]></add>
		</operation>
		<operation error="skip">
			<search position="replace"><![CDATA[WHERE `query`]]></search>
			<add><![CDATA[WHERE language_id = " . (int)$this->config->get('config_language_id') . " AND `query`]]></add>
		</operation>
		<operation error="skip">
			<search position="replace"><![CDATA[if ($url) {]]></search>
			<add><![CDATA[if (($url) && ($url <> '/'.$this->session->data['language'])){]]></add>
		</operation>		
		<operation error="skip">
			<search position="replace"><![CDATA[$this->request->get['route'] = 'product/product';]]></search>
			<add><![CDATA[$this->request->get['route'] = 'product/product'; $this->session->data['product_id'] = $this->request->get['product_id'];]]></add>
		</operation>		
		<operation error="skip">
			<search position="replace"><![CDATA[$this->request->get['route'] = 'product/category';]]></search>
			<add><![CDATA[$this->request->get['route'] = 'product/category'; $this->session->data['path'] = $this->request->get['path'];]]></add>
		</operation>		
		<operation error="skip">
			<search position="replace"><![CDATA[$this->request->get['route'] = 'product/manufacturer/info';]]></search>
			<add><![CDATA[$this->request->get['route'] = 'product/manufacturer/info'; $this->session->data['manufacturer_id'] = $this->request->get['manufacturer_id'];]]></add>
		</operation>
		<operation error="skip">
			<search position="replace"><![CDATA[$this->request->get['route'] = 'product/manufacturer/product';]]></search>
			<add><![CDATA[$this->request->get['route'] = 'product/manufacturer/product'; $this->session->data['manufacturer_id'] = $this->request->get['manufacturer_id'];]]></add>
		</operation>		
		<operation error="skip">
			<search position="replace"><![CDATA[$this->request->get['route'] = 'information/information';]]></search>
			<add><![CDATA[$this->request->get['route'] = 'information/information'; $this->session->data['information_id'] = $this->request->get['information_id'];]]></add>
		</operation>		
		<operation error="skip">
			<search position="after"><![CDATA[$this->request->get['route'] = 'information/information';]]></search>
			<add><![CDATA[	
			}
			}
			if (isset($this->request->get['route']) && ($this->request->get['_route_'] != '404.shtml')) { $this->session->data['proute'] = $this->request->get['route']; }
			if (isset($this->session->data['proute']) && strpos($this->session->data['proute'],'blog')!==false) { if(true) {unset($this->session->data['proute']);
			]]></add>
		</operation>		
					
	</file>
	
	<file name="catalog/controller/common/header.php">
		<operation>
			<search position="before"><![CDATA[$data['base']]]></search>
			<add><![CDATA[
				$data['alternate'] = '';
				$mlseo = $this->config->get('mlseo');
				if (isset($mlseo['hreflang'])) {	
					$this->load->model('localisation/language');
					$languages = $this->model_localisation_language->getLanguages();
					
					if (isset($this->request->get['route'])) {
						if ($this->request->get['route'] == 'product/product') {
							foreach($languages as $xlanguage) {
																
								
								$squery = $this->db->query("SELECT `value` FROM `" . DB_PREFIX . "setting` WHERE `key` = 'config_language'");
								if (isset($xlanguage['code']) && ($xlanguage['code'] != $squery->row['value'])) {$url = $xlanguage['code'].'/';}
									else {$url = '';} 
									
								$query = $this->db->query("select * from " . DB_PREFIX . "url_alias where CONCAT('product_id=', CAST(".$this->request->get['product_id']." as CHAR)) = query and language_id = ".  $xlanguage['language_id']);
								if ($query->num_rows) {
									$url .= $query->row['keyword'];
								}
								
								$data['alternate'] .='<link rel="alternate" hreflang="'.$xlanguage['code'].'" href="'.HTTP_SERVER.$url.'" />';
								 
								
							}
						}
						
						if ($this->request->get['route'] == 'product/category') {
							$xcats = explode('_', $this->request->get['path']); $xcat = end($xcats);
							foreach($languages as $xlanguage) {
															
								
								$squery = $this->db->query("SELECT `value` FROM `" . DB_PREFIX . "setting` WHERE `key` = 'config_language'");
								if (isset($xlanguage['code']) && ($xlanguage['code'] != $squery->row['value'])) {$url = $xlanguage['code'].'/';}
									else {$url = '';} 
									
								$query = $this->db->query("select * from " . DB_PREFIX . "url_alias where CONCAT('category_id=', CAST(".$xcat." as CHAR)) = query and language_id = ".  $xlanguage['language_id']);
								if ($query->num_rows) {
									$url .= $query->row['keyword'];
								}
								
								$data['alternate'] .='<link rel="alternate" hreflang="'.$xlanguage['code'].'" href="'.HTTP_SERVER.$url.'" />';
								 
								
							}
						}
						
						if ($this->request->get['route'] == 'product/manufacturer/info') {
							foreach($languages as $xlanguage) {
																
								
								$squery = $this->db->query("SELECT `value` FROM `" . DB_PREFIX . "setting` WHERE `key` = 'config_language'");
								if (isset($xlanguage['code']) && ($xlanguage['code'] != $squery->row['value'])) {$url = $xlanguage['code'].'/';}
									else {$url = '';} 
									
								$query = $this->db->query("select * from " . DB_PREFIX . "url_alias where CONCAT('manufacturer_id=', CAST(".$this->request->get['manufacturer_id']." as CHAR)) = query and language_id = ".  $xlanguage['language_id']);
								if ($query->num_rows) {
									$url .= $query->row['keyword'];
								}
								
								$data['alternate'] .='<link rel="alternate" hreflang="'.$xlanguage['code'].'" href="'.HTTP_SERVER.$url.'" />';
								 
								
							}
						}
						
						if ($this->request->get['route'] == 'information/information') {
							foreach($languages as $xlanguage) {
															
								
								$squery = $this->db->query("SELECT `value` FROM `" . DB_PREFIX . "setting` WHERE `key` = 'config_language'");
								if (isset($xlanguage['code']) && ($xlanguage['code'] != $squery->row['value'])) {$url = $xlanguage['code'].'/';}
									else {$url = '';} 
									
								$query = $this->db->query("select * from " . DB_PREFIX . "url_alias where CONCAT('information_id=', CAST(".$this->request->get['information_id']." as CHAR)) = query and language_id = ".  $xlanguage['language_id']);
								if ($query->num_rows) {
									$url .= $query->row['keyword'];
								}
								
								$data['alternate'] .='<link rel="alternate" hreflang="'.$xlanguage['code'].'" href="'.HTTP_SERVER.$url.'" />';
								 
								
							}
						}
						
						
					
					}
				}
				
				]]></add>
		</operation>
		<operation error="skip">
			<search position="replace" index="1"><![CDATA[$this->redirect($this->request->post['redirect']);]]></search>
			<add><![CDATA[
			$query = $this->db->query("SELECT * FROM " . DB_PREFIX . "language");
			foreach ($query->rows as $language)
				{	
					$this->request->post['redirect'] = str_replace('/'.$language['code'].'/', '/'.$this->request->post['language_code'].'/', $this->request->post['redirect']);
				}
			$query = $this->db->query("SELECT language_id FROM " . DB_PREFIX . "language WHERE code = '" . $this->request->post['language_code'] . "'");
			$this->config->set('config_language_id', $query->row['language_id']);
			
			if ($this->session->data['proute'] == 'product/product') {$this->redirect($this->url->link('product/product', 'product_id=' . $this->session->data['product_id']));}
			elseif ($this->session->data['proute'] == 'product/category') {$this->redirect($this->url->link('product/category', 'path=' . $this->session->data['path']));}
			elseif ($this->session->data['proute'] == 'product/manufacturer/product') {$this->redirect($this->url->link('product/manufacturer/product', 'manufacturer_id=' . $this->session->data['manufacturer_id']));}
			elseif ($this->session->data['proute'] == 'information/information') {$this->redirect($this->url->link('information/information', 'information_id=' . $this->session->data['information_id']));}
			else {$this->redirect($this->request->post['redirect']);}
			]]></add>
		</operation>			
	</file>
	<file name="catalog/view/theme/*/template/common/header.tpl">
		<operation>
			<search position="after"><![CDATA[base href]]></search>
			<add><![CDATA[<?php if (isset($alternate)) {echo $alternate;} ?>
			]]></add>
		</operation>			
	</file>
	<file name="catalog/controller/common/language.php">
		<operation >
			<search position="replace" index="1"><![CDATA[$this->response->redirect($this->request->post['redirect']);]]></search>
			<add><![CDATA[			
			$query = $this->db->query("SELECT * FROM " . DB_PREFIX . "language");
			foreach ($query->rows as $language)
				{	
					$this->request->post['redirect'] = str_replace('/'.$language['code'].'/', '/'.$this->request->post['code'].'/', $this->request->post['redirect']);
				}
			$query = $this->db->query("SELECT language_id FROM " . DB_PREFIX . "language WHERE code = '" . $this->request->post['code'] . "'");
			$this->config->set('config_language_id', $query->row['language_id']);
						
			if ((isset($this->session->data['proute']))&&($this->session->data['proute'] == 'product/product')) {$this->response->redirect($this->url->link('product/product', 'product_id=' . $this->session->data['product_id']));}
			elseif ((isset($this->session->data['proute']))&&($this->session->data['proute'] == 'product/category')) {$this->response->redirect($this->url->link('product/category', 'path=' . $this->session->data['path']));}
			elseif ((isset($this->session->data['proute']))&&($this->session->data['proute'] == 'product/manufacturer/info')) {$this->response->redirect($this->url->link('product/manufacturer/info', 'manufacturer_id=' . $this->session->data['manufacturer_id']));}
			elseif ((isset($this->session->data['proute']))&&($this->session->data['proute'] == 'information/information')) {$this->response->redirect($this->url->link('information/information', 'information_id=' . $this->session->data['information_id']));}
			elseif (isset($this->session->data['proute'])) {$this->response->redirect($this->url->link($this->session->data['proute']));}
			else {$this->response->redirect($this->request->post['redirect']);}						
			]]></add>
		</operation>			
	</file>
	
	<file name="admin/model/catalog/seoreport.php">
		<operation error="skip">
			<search position="replace"><![CDATA[url_alias u on  CONCAT('product_id]]></search>
			<add><![CDATA[url_alias u on u.language_id = pd.language_id and CONCAT('product_id]]></add>
		</operation>			
		<operation error="skip">
			<search position="replace"><![CDATA[url_alias u on  CONCAT('category_id]]></search>
			<add><![CDATA[url_alias u on u.language_id = cd.language_id and CONCAT('category_id]]></add>
		</operation>			
		<operation error="skip">
			<search position="replace"><![CDATA[url_alias u on  CONCAT('information_id]]></search>
			<add><![CDATA[url_alias u on u.language_id = id.language_id and CONCAT('information_id]]></add>
		</operation>			
		<operation error="skip">
			<search position="replace"><![CDATA[url_alias u on  CONCAT('manufacturer_id]]></search>
			<add><![CDATA[url_alias u on u.language_id = '" . (int)$this->session->data['language_id'] . "' and CONCAT('manufacturer_id]]></add>
		</operation>					
	</file>
	<file name="admin/model/catalog/seoeditor.php">
		<operation error="skip">
			<search position="replace"><![CDATA[url_alias u on  CONCAT('product_id]]></search>
			<add><![CDATA[url_alias u on u.language_id = pd.language_id and CONCAT('product_id]]></add>
		</operation>			
		<operation error="skip">
			<search position="replace"><![CDATA[url_alias u on  CONCAT('category_id]]></search>
			<add><![CDATA[url_alias u on u.language_id = cd.language_id and CONCAT('category_id]]></add>
		</operation>			
		<operation error="skip">
			<search position="replace"><![CDATA[url_alias u on  CONCAT('information_id]]></search>
			<add><![CDATA[url_alias u on u.language_id = id.language_id and CONCAT('information_id]]></add>
		</operation>			
		<operation error="skip">
			<search position="replace"><![CDATA[url_alias u on  CONCAT('manufacturer_id]]></search>
			<add><![CDATA[url_alias u on u.language_id = '" . (int)$this->session->data['language_id'] . "' and CONCAT('manufacturer_id]]></add>
		</operation>					
	</file>
	<file name="admin/controller/catalog/seoedit.php">
		<operation error="skip">
			<search position="replace"><![CDATA[where query]]></search>
			<add><![CDATA[where language_id = $language_id and query]]></add>
		</operation>			
		<operation error="skip">
			<search position="replace"><![CDATA[url_alias(query, keyword) values(]]></search>
			<add><![CDATA[url_alias(language_id, query, keyword) values($language_id,]]></add>
		</operation>					
	</file>
	<file name="admin/controller/feed/google_sitemap.php" error="skip">
		<operation>
			<search position="after"><![CDATA[$this->document->setTitle($this->language->get('heading_title'));]]></search>
			<add><![CDATA[
			$data['extra_languages'] = array();
			$query = $this->db->query("SELECT DISTINCT ua.language_id, l.code, l.name FROM " . DB_PREFIX . "url_alias ua INNER JOIN " . DB_PREFIX . "language l on l.language_id = ua.language_id ;");
			$data['extra_languages'] = $query->rows;					
			]]></add>
		</operation>							
	</file>
	<file name="admin/controller/extension/feed/google_sitemap.php" error="skip">
		<operation>
			<search position="after"><![CDATA[$this->document->setTitle($this->language->get('heading_title'));]]></search>
			<add><![CDATA[
			$data['extra_languages'] = array();
			$query = $this->db->query("SELECT DISTINCT ua.language_id, l.code, l.name FROM " . DB_PREFIX . "url_alias ua INNER JOIN " . DB_PREFIX . "language l on l.language_id = ua.language_id ;");
			$data['extra_languages'] = $query->rows;					
			]]></add>
		</operation>							
	</file>
	<file name="admin/view/template/feed/google_sitemap.tpl" error="skip">
		<operation>
			<search position="before"><![CDATA[</form>]]></search>
			<add><![CDATA[
			<?php foreach ($extra_languages as $extra_language) { ?>
				<div class="form-group">
				<label class="col-sm-2 control-label" for="input-data-feed"><?php echo $entry_data_feed.' (for '.$extra_language['name'].')'; ?></label>
				<div class="col-sm-10">
				  <textarea rows="2" readonly="readonly" id="input-data-feed" class="form-control"><?php echo HTTP_CATALOG . 'index.php?route=feed/google_sitemap_extra&language='.$extra_language['code']; ?></textarea>
				</div>
			  </div>				
			<?php } ?>
			]]></add>
		</operation>							
	</file>
	<file name="admin/view/template/extension/feed/google_sitemap.tpl" error="skip">
		<operation>
			<search position="before"><![CDATA[</form>]]></search>
			<add><![CDATA[
			<?php foreach ($extra_languages as $extra_language) { ?>
				<div class="form-group">
				<label class="col-sm-2 control-label" for="input-data-feed"><?php echo $entry_data_feed.' (for '.$extra_language['name'].')'; ?></label>
				<div class="col-sm-10">
				  <textarea rows="2" readonly="readonly" id="input-data-feed" class="form-control"><?php echo HTTP_CATALOG . 'index.php?route=feed/google_sitemap_extra&language='.$extra_language['code']; ?></textarea>
				</div>
			  </div>				
			<?php } ?>
			]]></add>
		</operation>							
	</file>
	
</modification>



